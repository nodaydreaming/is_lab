<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>网络与信息安全实验室后台</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">

        <link rel="stylesheet" href="../../layui/css/layui.css"  media="all">
        <link rel="stylesheet" href="../../layui/css/global.css" media="all">
        <link rel="stylesheet" href="../../layui/css/modules/code.css" media="all">
        <link rel="stylesheet" href="../../layui/css/modules/layer/default/layer.css" media="all">

        <script type="text/javascript" src="../../js/jquery-1.10.2.js"></script>
        <script type="text/javascript" src="../../layui/layui.all.js"></script>
        <script type="text/javascript" src="../../layui/lay/modules/layer.js"></script>
        <script type="text/javascript" src="../../layui/lay/modules/jquery.js"></script>

        <script type="text/javascript" src="../js/general.js"></script>
        <script type="text/javascript" src="js/addUser.js"></script>
        <style>
            .layui-nav-tree{vertical-align: top;}
        </style>
    </head>
    <body>
        <div class="layui-layout layui-layout-admin">
            <div class="layui-header header header-demo" winter="">
              <div class="layui-main">
                <a class="" href="../main.html" style="font-size: 17px;color: white; line-height: 55px; font-weight: 500">
                  网络与信息安全实验室
                </a>
                <ul class="layui-nav">

                  <li class="layui-nav-item">
                    <a href="../../Lab301Home.html">返回首页</a>
                  </li>

                  <li class="layui-nav-item" lay-unselect="" id="showDlLi" onmouseover="change('block')" onmouseout="change('none')">
                    <a href="javascript:;">
                      <img src="../../images/user_default.jpg" class="layui-nav-img">
                      我
                      <span class="layui-nav-more"></span>
                    </a>
                    <dl class="layui-nav-child layui-anim layui-anim-upbit" id="list_cur" style="top: 60px;">
                        <dd style="border: 0px; height: 5px;"></dd>
                        <dd><a onclick="updatePwd()" style="cursor:pointer;">修改密码</a></dd>
                        <dd><a onclick="updateAdminInfo()" style="cursor:pointer;">修改信息</a></dd>
                        <dd><a onclick="signOut()" style="cursor:pointer;">退出</a></dd>
                    </dl>
                    </li>

                  <span class="layui-nav-bar" style="left: 6.01px; top: 55px; width: 0px; opacity: 0;"></span>
                </ul>
              </div>
            </div>
            <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
            <!--[if lt IE 9]>
              <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
              <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
            <![endif]-->
            <div class="layui-side layui-bg-black">
              <div class="layui-side-scroll">
              <ul class="layui-nav layui-nav-tree site-demo-nav">
                <li class="layui-nav-item">
                  <a href="javascript:;" onclick="aClick()">基础信息修改<span class="layui-nav-more"></span></a>
                  <!-- <span class="layui-nav-more"></span> -->
                  <dl class="layui-nav-child">
                    <dd class="">
                      <a class="aHover" href="../info/libIntro.html">实验室简介</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../info/achievementSummary.html">成果总览</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../info/awards.html">获奖情况</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../info/researchDirection.html">研究方向</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../info/teacher.html">指导老师</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../info/rule.html">规章制度</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../info/registration.html">报名情况</a>
                    </dd>
                  </dl>
                </li>

                <li class="layui-nav-item">
                  <a href="javascript:;" onclick="aClick()">成员管理<span class="layui-nav-more"></span></a>
                  <dl class="layui-nav-child">
                    <dd class="">
                      <a class="aHover" href="../member/postgraduate.html">研究生</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../member/undergraduate.html">本科生</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../member/graduate.html">毕业生</a>
                    </dd>
                  </dl>
                </li>

                <li class="layui-nav-item">
                  <a href="javascript:;" onclick="aClick()">成果管理<span class="layui-nav-more"></span></a>
                  <dl class="layui-nav-child">
                    <dd class="">
                      <a class="aHover" href="../achievement/project.html">项目</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../achievement/works.html">作品</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../achievement/paper.html">论文</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../achievement/patent.html">专利</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../achievement/softwareCopyright.html">软著</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../achievement/competition.html">竞赛</a>
                    </dd>
                  </dl>
                </li>
                <!--<li class="layui-nav-item">-->
                  <!--<a href="javascript:;" onclick="aClick()">公告通知<span class="layui-nav-more"></span></a>-->
                  <!--<dl class="layui-nav-child">-->
                    <!--<dd class="">-->
                      <!--<a class="aHover" href="../notice/notice.html">公告</a>-->
                    <!--</dd>-->
                    <!--<dd class="">-->
                      <!--<a class="aHover" href="../notice/inform.html">通知</a>-->
                    <!--</dd>-->
                  <!--</dl>-->
                <!--</li>-->
                <li class="layui-nav-item">
                  <a href="javascript:;" onclick="aClick()">实验室文化<span class="layui-nav-more"></span></a>
                  <dl class="layui-nav-child">
                    <dd class="">
                      <a class="aHover" href="../culture/cucoloris.html">生活剪影</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../culture/leagueBuilding.html">团建活动</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../culture/graduationPhoto.html">毕业时分</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="../culture/addCulture.html">添加实验室文化</a>
                    </dd>
                  </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                  <a href="javascript:;" onclick="aClick()">管理员信息<span class="layui-nav-more"></span></a>
                  <dl class="layui-nav-child">
                    <dd class="layui-this">
                      <a class="aHover" href="#">添加管理员</a>
                    </dd>
                    <dd class="">
                      <a class="aHover" href="updateUser.html">管理员列表</a>
                    </dd>
                  </dl>
                </li>

                <li class="layui-nav-item" style="height: 30px; text-align: center"></li>
                <span class="layui-nav-bar" id = "nav-bar" style="top: 232.5px; height: 0px; opacity: 0;"></span>
              </ul>
            </div>
          </div>
        </div>

        <div class="layui-body layui-tab-content site-demo site-demo-body" style="margin-top: 70px;">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>添加管理员</legend>
            </fieldset>
            <form class="layui-form" action="">
                <div class="layui-form-item layui-upload">
                    <label class="layui-form-label">照&nbsp;&nbsp;&nbsp;片</label>
                    <div class="layui-upload-list">
                          <img class="layui-upload-img" id="demo1" style="float:left;" src="">
                          <div style="float:left;">
                             <button type="button" class="layui-btn" id="upload">上传图片</button>
                             <p id="demoText" style="width: 100px; margin-top: 20px"></p>
                          </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">用户名</label>
                    <div class="layui-input-block">
                      <input type="text" name="username" autocomplete="off" placeholder="请输入用户名" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                    </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">密&nbsp;&nbsp;&nbsp;码</label>
                      <div class="layui-input-block">
                        <input type="password" name="password" placeholder="请输入密码" autocomplete="off" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                      </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">确认密码</label>
                  <div class="layui-input-block">
                    <input type="password" id="confirmPwd" placeholder="请确认密码" autocomplete="off" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()" onblur="passwordLimit()">
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">性&nbsp;&nbsp;&nbsp;别</label>
                  <div class="layui-input-block">
                      <input name="sex" title="男" type="radio" checked="" value="男">
                      <div class="layui-unselect layui-form-radio layui-form-radioed">
                        <i class="layui-anim layui-icon"></i>
                        <div>男</div>
                      </div>
                      <input name="sex" title="女" type="radio" value="女">
                      <div class="layui-unselect layui-form-radio">
                        <i class="layui-anim layui-icon"></i>
                        <div>女</div>
                      </div>
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">昵&nbsp;&nbsp;&nbsp;称</label>
                  <div class="layui-input-block">
                    <input type="text" name="nickname" autocomplete="off" placeholder="请输入昵称" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">邮&nbsp;&nbsp;&nbsp;箱</label>
                  <div class="layui-input-block">
                    <input type="text" name="email" autocomplete="off" lay-verify="email" placeholder="请输入邮箱" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">手机号</label>
                  <div class="layui-input-block">
                    <input type="text" name="phone" autocomplete="off" lay-verify="phone" placeholder="请输入手机号" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                  </div>
                </div>

                <div class="layui-form-item">
                  <div class="layui-input-block">
                    <button type="button" class="layui-btn" onclick="adduser()">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary" onclick="
                      $('#demo1').attr('src', '');
                    ">重置</button>
                  </div>
                </div>
            </form>

        </div>

        <script>
            function passwordLimit(){
                var input = window.event.target;
                input.value = input.value.substring(0,100); if(window.event.keyCode ==13) return false;
                var pwd = document.getElementsByName("password")[0];
                if(pwd.value != input.value){
                    layer.tips('两次密码不一样', '#confirmPwd');
                }
            }
            layui.use('form', function(){
              var form = layui.form;
              form.render();
              form.verify();
            });
            var photo, username, password, confirmPwd, gender, nickname, email, telephone;
            var uploadInst;
            function adduser(){
                username = document.getElementsByName('username')[0].value;
                password = document.getElementsByName('password')[0].value;
                confirmPwd = document.getElementById('confirmPwd').value;
                gender = ((document.getElementsByClassName('layui-form-radioed'))[0]).childNodes[1].innerText;
                nickname = document.getElementsByName('nickname')[0].value;
                email = document.getElementsByName('email')[0].value;
                telephone = document.getElementsByName('phone')[0].value;
                var reg1 = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");
                var reg2 = new RegExp("^1(3|4|5|7|8)\\d{9}$");
                console.log("in fun()");
                if(username == "" || username == null){
                    layer.msg("用户名不能为空！");
                }
                else if(password == null || password == ""){
                    layer.msg("密码不能为空！");
                }
                else if(confirmPwd == null || confirmPwd == ""){
                    layer.tips("请再次输入密码！", "#confirmPwd");
                }
                else if(gender == "" || gender == null){
                    layer.msg("请选择性别！");
                }
                else if(nickname == "" || nickname == null){
                    layer.msg("昵称不能为空！");
                }
                else if(email != null && email != "" && !reg1.test(email)){
                    layer.msg("请注意邮箱格式！");
                }
                else if(telephone == "" || telephone == null){
                    layer.msg("手机号不能为空！");
                }
                else if(!reg2.test(telephone)){
                    layer.msg("请注意手机号格式！");
                }
                else if(photo != null) {
                    uploadInst.upload();
                }
                else {
                    addUser(photo, username, password, gender, nickname, email, telephone);
                }
            }
            layui.use('upload', function() {
                var $ = layui.jquery, upload = layui.upload;
                //普通图片上传使用layui上传图片
                uploadInst = upload.render({
                    elem: '#upload'
                    , url: 'uploadUserImg.action'
                    , accept : 'images'
                    , multiple : false
                    , auto : false
                    , field : 'upload'
                    , choose: function (obj) { +
                        //预读本地文件示例，不支持ie8 +
                        obj.preview(function (index, file, result) {
                            $('.layui-upload').css("height", "10%");
                            $('.layui-upload').css("marginButtom", "10px");
                            $('#demo1').attr('src', result); //图片链接（base64）
                            $('#demo1').css("maxWidth", "10%");
                            $('#demo1').css("marginRight", "10px");
                            photo = result;
                        });
                    }
                    , done: function (res) {
                        //如果上传失败
                        if (res.code > 0) {
                            return layer.msg('上传失败');
                        }
                        //上传成功
                        else
                        {
                            photo = res.src;
                            $('#demo1').attr('src', photo);
                            addUser(photo, username, password, gender, nickname, email, telephone);
                        }
                    }
                    , error: function () {
                        //演示失败状态，并实现重传
                        var demoText = $('#demoText');
                        demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                        demoText.find('.demo-reload').on('click', function () {
                            uploadInst.upload();
                        });
                   }
                });
            });
        </script>
    </body>

</html>